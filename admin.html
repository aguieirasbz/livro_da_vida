<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin - Olhar Rubro-Negro</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: Arial, sans-serif; background:#0f0f0f; color:#fff; }
    header { background:#ff0000; padding:15px; text-align:center; font-size:1.5rem; font-weight:bold; margin-bottom:20px; }
    .container { max-width: 900px; margin: 0 auto; padding: 20px; }
    input, button { font-size: 1rem; }
    .video-item { display: flex; justify-content: space-between; gap:10px; background:#1c1c1c; padding:8px; border-radius:8px; margin-bottom:10px; align-items:center; }
    .video-item img { width:120px; height:67px; border-radius:5px; }
    .video-info { flex:1; margin-left:10px; }
    .btn { padding:5px 10px; border-radius:5px; cursor:pointer; }
    .btn-edit { background:#3b82f6; color:white; }
    .btn-delete { background:#ef4444; color:white; }
    .form-group { margin-bottom:10px; display:flex; flex-direction:column; gap:5px; }
  </style>
</head>
<body>

<header>Admin - Gerenciar Vídeos</header>

<div class="container">

  <section class="mb-6">
    <h2 class="text-xl font-bold mb-2">Adicionar / Editar Vídeo</h2>
    <div class="form-group">
      <label>Título:</label>
      <input type="text" id="titulo" class="p-2 rounded text-black" placeholder="Título do vídeo">
    </div>
    <div class="form-group">
      <label>ID do YouTube:</label>
      <input type="text" id="videoId" class="p-2 rounded text-black" placeholder="Ex: dQw4w9WgXcQ">
    </div>
    <input type="hidden" id="editingIndex" value="-1">
    <button id="saveBtn" class="btn btn-edit">Salvar Vídeo</button>
    <button id="cancelBtn" class="btn btn-delete">Cancelar</button>
    
    <button id="exportBtn" class="btn w-full mt-2" style="background:#22c55e; color:white;">Exportar videos.json</button>

  </section>

  <section>
    <h2 class="text-xl font-bold mb-2">Lista de Vídeos</h2>
    <div id="videosList"></div>
  </section>

</div>

<script>
  // ATUALIZADO: Script com função de exportar

  const STORAGE_KEY = 'olhar_rubro_negro_videos';
  const tituloInput = document.getElementById('titulo');
  const videoIdInput = document.getElementById('videoId');
  const editingIndex = document.getElementById('editingIndex');
  const saveBtn = document.getElementById('saveBtn');
  const cancelBtn = document.getElementById('cancelBtn');
  const videosList = document.getElementById('videosList');
  const exportBtn = document.getElementById('exportBtn'); // Pega o novo botão

  function loadVideos(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return [];
      const parsed = JSON.parse(raw);
      return Array.isArray(parsed) ? parsed : [];
    }catch(e){ console.warn(e); return []; }
  }

  function saveVideos(videos){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(videos));
    renderList();
  }

  function renderList(){
    const videos = loadVideos();
    videosList.innerHTML = '';
    if(videos.length===0){
      videosList.innerHTML = '<p>Nenhum vídeo cadastrado.</p>';
      return;
    }
    videos.forEach((v,i)=>{
      const div = document.createElement('div');
      div.className = 'video-item';
      div.innerHTML = `
        <img src="https://img.youtube.com/vi/${v.id}/mqdefault.jpg">
        <div class="video-info">
          <div>${v.titulo}</div>
          <div class="text-sm text-gray-400">ID: ${v.id}</div>
        </div>
        <div class="flex gap-2">
          <button class="btn btn-edit" data-index="${i}" data-action="edit">Editar</button>
          <button class="btn btn-delete" data-index="${i}" data-action="delete">Excluir</button>
        </div>
      `;
      videosList.appendChild(div);
    });
  }

  saveBtn.addEventListener('click', ()=>{
    const titulo = tituloInput.value.trim();
    const id = videoIdInput.value.trim();
    if(!titulo || !id){ alert('Preencha todos os campos'); return; }

    const videos = loadVideos();
    const idx = Number(editingIndex.value);
    const videoObj = { titulo, id };

    if(idx>=0){
      videos[idx] = videoObj;
    }else{
      videos.push(videoObj);
    }
    saveVideos(videos);
    clearForm();
  });

  cancelBtn.addEventListener('click', ()=>{
    clearForm();
  });

  videosList.addEventListener('click',(e)=>{
    const btn = e.target.closest('button');
    if(!btn) return;
    const action = btn.dataset.action;
    const idx = Number(btn.dataset.index);
    const videos = loadVideos();
    if(action==='delete'){
      if(confirm('Excluir este vídeo?')){
        videos.splice(idx,1);
        saveVideos(videos);
      }
    }else if(action==='edit'){
      tituloInput.value = videos[idx].titulo;
      videoIdInput.value = videos[idx].id;
      editingIndex.value = idx;
      window.scrollTo({top:0, behavior:'smooth'});
    }
  });

  function clearForm(){
    tituloInput.value = '';
    videoIdInput.value = '';
    editingIndex.value = '-1';
  }

  // --- NOVO CÓDIGO DE EXPORTAÇÃO ---
  exportBtn.addEventListener('click', () => {
    // 1. Carrega os vídeos do localStorage
    const videos = loadVideos();
    
    // 2. Converte a lista para uma string JSON formatada
    const jsonString = JSON.stringify(videos, null, 2); // (null, 2) deixa o arquivo bonito e legível
    
    // 3. Cria um "Blob" (um arquivo em memória)
    const blob = new Blob([jsonString], { type: 'application/json' });
    
    // 4. Cria um link temporário para fazer o download
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'videos.json'; // Este é o nome do arquivo que será baixado
    
    // 5. Simula um clique no link para iniciar o download
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  });
  // --- FIM DO NOVO CÓDIGO ---

  // Inicializa lista
  renderList();
</script>

</body>
</html>